<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<link rel="stylesheet" href="cadastro.css">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap');
</style>
<body>
    <div id="container-cadastro">
        <img class="logo-cadastro" onclick="window.location.href='index.html' " src="ChatGPT_Image_28_de_abr._de_2025__14_36_26__1_-removebg-preview.png" alt="">
        <div id="caixa-cadastro">
        <h1 id="titulo">Cadastrar Objeto</h1>
        <div style="width: 58%; height: 2px; background-color: white;"></div>
        <div class="botoes-cadastro">
            <form id="form-cadastro">
                <!-- Código gerado automaticamente -->
                <h2 id="codigo-cadastro">Código: <span id="numero"></span></h2>
                <input type="hidden" id="codigoInput-cadastro" name="codigo">

                <!-- Tipo do objeto -->
                <input class="input-cadastro" type="text" placeholder="Monitor, Impressora..." id="obj-cadastro" required>
                <label class="label-cadastro"  for="obj">Objeto</label>

                <!-- Complemento -->
                <input  class="input-cadastro" type="text" placeholder="Cor branca, Positivo..." id="complemento-cadastro" required>
                <label class="label-cadastro"  for="complemento">Complemento</label>

                <!-- Estado -->
                <select id="estado-cadastro" required>
                    <option value="">Selecionar</option>
                    <option value="otimo">Ótimo</option>
                    <option value="utilizavel">Utilizável</option>
                    <option value="ruim">Ruim</option>
                </select>
                <label class="label-cadastro" for="estado">Estado do Objeto</label>
                <br>
                <!-- Piso -->
                <select id="Piso-cadastro" onchange="atualizarLocais()" required>
                    <option value="">Selecionar</option>
                    <option value="piso1">Piso 1</option>
                    <option value="piso2">Piso 2</option>
                    <option value="garagem">Garagem</option>
                </select>
                <label class="label-cadastro"  for="Piso">Piso</label>

                <!-- Local (sala) -->
                <select id="Local-cadastro" required>
                    <option value="">Selecionar</option>
                </select>
                <label class="label-cadastro"  for="Local">Local</label>

                <!-- Botão de envio -->
                <button type="button" id="concluido-cadastro">Concluído</button>
            </form>
        </div>
        
        </div>
    </div>

    <script>
        //Locais
      const locaisPorPiso = {
    piso1: ["Gabinete", "Plenário"],
    piso2: ["COTEC"],
    garagem: ["Copa"]
};

function atualizarLocais() {
    const pisoSelecionado = document.getElementById("Piso").value;
    const localSelect = document.getElementById("Local");

    localSelect.innerHTML = '<option value="">Selecionar</option>';

    if (locaisPorPiso[pisoSelecionado]) {
        locaisPorPiso[pisoSelecionado].forEach(local => {
            const option = document.createElement("option");
            option.value = local;
            option.textContent = local;
            localSelect.appendChild(option);
        });
    }
}

//Pop-up

        document.getElementById("concluido").addEventListener("click", function () {
            const obj = document.getElementById("obj").value.trim();
            const complemento = document.getElementById("complemento").value.trim();
            const estado = document.getElementById("estado").value.trim();
            const piso = document.getElementById("Piso").value.trim();
            const local = document.getElementById("Local").value.trim();

            if (!obj || !complemento || !estado || !piso || !local) {
                alert("Por favor, preencha todos os campos antes de concluir o cadastro.");
            } else {
                 alert("Cadastro realizado com sucesso!");
                window.location.href = "busca.html"; 
            }
        });
function fecharPopup() {
    document.getElementById("popup").style.display = "none";
}

// Gerar Código

let codigoGerado = "";

async function gerarCodigo() {
    const res = await fetch("http://localhost:3000/codigo");
    const data = await res.json();
    codigoGerado = data.codigo;

    document.getElementById("numero").textContent = codigoGerado;
    document.getElementById("codigoInput").value = codigoGerado;
}

document.getElementById("form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
        codigo: document.getElementById("codigoInput").value,
        tipoObjeto: document.getElementById("obj").value,
        status: document.getElementById("estado").value,
        sala: document.getElementById("Local").value,
        complemento: document.getElementById("complemento").value
    };

    const res = await fetch("http://localhost:3000/cadastrar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();
    alert(data.mensagem || data.erro);
});

gerarCodigo();

    </script>

</body>
</html>